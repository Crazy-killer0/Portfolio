<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> 404 CTF 2024 - Artificial intelligence serie - AI | Cyberrzzerk</title>
  <link rel = 'canonical' href = 'https://crazy-killer0.github.io/Portfolio//posts/404-ctf-2024-artificial-intelligence-serie/'>
  <meta name="description" content="Writing some write up of cool CTF’s challenges and infosec content.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="404 CTF 2024 - Artificial intelligence serie - AI" />
<meta property="og:description" content="List of Challenges Du poison [1/2] Du poison [2/2] Du poison [3/2] Des portes dérobées Du poison [1/2] - Introduction Reminder of the Statement Lors de votre dernière compétition de voile, vous avez regardé les hélicoptères passer au-dessus de vous pour commenter la compétition. Qu&rsquo;est-ce qu&rsquo;ils sont agaçants ! À critiquer tous les participants alors qu&rsquo;ils ne sont même pas sur l&rsquo;eau&hellip;
Vous décidez de vous amuser un peu. Ils utilisent une intelligence artificielle pour détecter les voiliers, c&rsquo;est bien ça ?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://crazy-killer0.github.io/Portfolio//posts/404-ctf-2024-artificial-intelligence-serie/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-05-15T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-05-15T00:00:00+00:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="404 CTF 2024 - Artificial intelligence serie - AI"/>
<meta name="twitter:description" content="List of Challenges Du poison [1/2] Du poison [2/2] Du poison [3/2] Des portes dérobées Du poison [1/2] - Introduction Reminder of the Statement Lors de votre dernière compétition de voile, vous avez regardé les hélicoptères passer au-dessus de vous pour commenter la compétition. Qu&rsquo;est-ce qu&rsquo;ils sont agaçants ! À critiquer tous les participants alors qu&rsquo;ils ne sont même pas sur l&rsquo;eau&hellip;
Vous décidez de vous amuser un peu. Ils utilisent une intelligence artificielle pour détecter les voiliers, c&rsquo;est bien ça ?"/>

  
  
    
  
  
<link rel="stylesheet" href="../../css/style.css"> 
  
  <link rel="stylesheet" href="../css/custom.css"> 
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://crazy-killer0.github.io/Portfolio/images/favicon.ico" />

  
  
  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="../../index.html">Home</a></li>
    
        <li><a href="../index.html">Categories</a></li>
      
        <li><a href="../../ranking/index.html">Ranking</a></li>
      
        <li><a href="../../whoami/index.html">Whoami</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://crazy-killer0.github.io/Portfolio//posts/404-ctf-2024-preview/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fcrazy-killer0.github.io/Portfolio/%2fposts%2f404-ctf-2024-artificial-intelligence-serie%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fcrazy-killer0.github.io/Portfolio/%2fposts%2f404-ctf-2024-artificial-intelligence-serie%2f&text=404%20CTF%202024%20-%20Artificial%20intelligence%20serie%20-%20AI" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fcrazy-killer0.github.io/Portfolio/%2fposts%2f404-ctf-2024-artificial-intelligence-serie%2f&title=404%20CTF%202024%20-%20Artificial%20intelligence%20serie%20-%20AI" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fcrazy-killer0.github.io/Portfolio/%2fposts%2f404-ctf-2024-artificial-intelligence-serie%2f&is_video=false&description=404%20CTF%202024%20-%20Artificial%20intelligence%20serie%20-%20AI" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=404%20CTF%202024%20-%20Artificial%20intelligence%20serie%20-%20AI&body=Check out this article: https%3a%2f%2fcrazy-killer0.github.io/Portfolio/%2fposts%2f404-ctf-2024-artificial-intelligence-serie%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fcrazy-killer0.github.io/Portfolio/%2fposts%2f404-ctf-2024-artificial-intelligence-serie%2f&title=404%20CTF%202024%20-%20Artificial%20intelligence%20serie%20-%20AI" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fcrazy-killer0.github.io/Portfolio/%2fposts%2f404-ctf-2024-artificial-intelligence-serie%2f&title=404%20CTF%202024%20-%20Artificial%20intelligence%20serie%20-%20AI" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fcrazy-killer0.github.io/Portfolio/%2fposts%2f404-ctf-2024-artificial-intelligence-serie%2f&name=404%20CTF%202024%20-%20Artificial%20intelligence%20serie%20-%20AI&description=List%20of%20Challenges%20Du%20poison%20%5b1%2f2%5d%20Du%20poison%20%5b2%2f2%5d%20Du%20poison%20%5b3%2f2%5d%20Des%20portes%20d%c3%a9rob%c3%a9es%20Du%20poison%20%5b1%2f2%5d%20-%20Introduction%20Reminder%20of%20the%20Statement%20Lors%20de%20votre%20derni%c3%a8re%20comp%c3%a9tition%20de%20voile%2c%20vous%20avez%20regard%c3%a9%20les%20h%c3%a9licopt%c3%a8res%20passer%20au-dessus%20de%20vous%20pour%20commenter%20la%20comp%c3%a9tition.%20Qu%26rsquo%3best-ce%20qu%26rsquo%3bils%20sont%20aga%c3%a7ants%20%21%20%c3%80%20critiquer%20tous%20les%20participants%20alors%20qu%26rsquo%3bils%20ne%20sont%20m%c3%aame%20pas%20sur%20l%26rsquo%3beau%26hellip%3b%0aVous%20d%c3%a9cidez%20de%20vous%20amuser%20un%20peu.%20Ils%20utilisent%20une%20intelligence%20artificielle%20pour%20d%c3%a9tecter%20les%20voiliers%2c%20c%26rsquo%3best%20bien%20%c3%a7a%20%3f" aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fcrazy-killer0.github.io/Portfolio/%2fposts%2f404-ctf-2024-artificial-intelligence-serie%2f&t=404%20CTF%202024%20-%20Artificial%20intelligence%20serie%20-%20AI" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#list-of-challenges">List of Challenges</a></li>
    <li><a href="#du-poison-12---introduction">Du poison [1/2] - Introduction</a>
      <ul>
        <li><a href="#reminder-of-the-statement">Reminder of the Statement</a></li>
        <li><a href="#solution">Solution</a></li>
      </ul>
    </li>
    <li><a href="#du-poison-22---facile">Du poison [2/2] - Facile</a>
      <ul>
        <li><a href="#reminder-of-the-statement-1">Reminder of the Statement</a></li>
        <li><a href="#solution-1">Solution</a></li>
      </ul>
    </li>
    <li><a href="#des-portes-dérobées---moyen">Des portes dérobées - Moyen</a>
      <ul>
        <li><a href="#reminder-of-the-statement-2">Reminder of the Statement</a></li>
        <li><a href="#solution-2">Solution</a></li>
      </ul>
    </li>
    <li><a href="#du-poison-32---moyen">Du poison [3/2] - Moyen</a>
      <ul>
        <li><a href="#reminder-of-the-statement-3">Reminder of the Statement</a></li>
        <li><a href="#solution-3">Solution</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        404 CTF 2024 - Artificial intelligence serie - AI
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2024-05-15 00:00:00 &#43;0000 UTC" itemprop="datePublished">2024-05-15</time>
          
        </div>
        
        
        <div class="article-read-time">
          <i class="far fa-clock"></i>
          
          8 minute read
        </div>
        
        
        <div class="article-category">
            <i class="fas fa-archive"></i>
            
            
            <a class="category-link" href="../../categories/404ctf2024/index.html">404CTF2024</a>
            
        </div>
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="../../tags/ctf/index.html" rel="tag">CTF</a>
            
             ,  
            <a class="tag-link" href="../../tags/ai/index.html" rel="tag">AI</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <h2 id="list-of-challenges">List of Challenges</h2>
<ul>
<li>Du poison [1/2]</li>
<li>Du poison [2/2]</li>
<li>Du poison [3/2]</li>
<li>Des portes dérobées</li>
</ul>
<h2 id="du-poison-12---introduction">Du poison [1/2] - Introduction</h2>
<h3 id="reminder-of-the-statement">Reminder of the Statement</h3>
<p>Lors de votre dernière compétition de voile, vous avez regardé les hélicoptères passer au-dessus de vous pour commenter la compétition. Qu&rsquo;est-ce qu&rsquo;ils sont agaçants ! À critiquer tous les participants alors qu&rsquo;ils ne sont même pas sur l&rsquo;eau&hellip;</p>
<p>Vous décidez de vous amuser un peu. Ils utilisent une intelligence artificielle pour détecter les voiliers, c&rsquo;est bien ça ? Ils ne sont même pas capables de reconnaître qui est dans quel voilier&hellip; En plus, ce ne sont pas eux qui s&rsquo;occupent de l&rsquo;entraînement de leur modèle ! Ils demandent à des participants de les aider. Vous décidez de vous amuser un peu, et de déteriorer les performances de leur modèle de reconnaissance de voilier.</p>
<p><em>Ce challenge est une introduction à l&rsquo;empoisonnement de modèles entraînés par apprentissage fédéré.</em></p>
<h3 id="solution">Solution</h3>
<p>The goal of this challenge is to deteriorate the performance of a recognition model. The solution is to poison the model by modifying its weights in a way that reduces its accuracy. The noise added is generated randomly. This noise is significant enough to disrupt the model&rsquo;s weights substantially, thereby reducing its performance.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests <span style="color:#66d9ef">as</span> rq
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EmpoisonneurNN</span>(NN):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, <span style="color:#f92672">**</span>kwargs):
</span></span><span style="display:flex;"><span>        super(EmpoisonneurNN, self)<span style="color:#f92672">.</span>__init__(<span style="color:#f92672">**</span>kwargs)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_weights</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># On récupère les poids normaux du modèle</span>
</span></span><span style="display:flex;"><span>        original_weights <span style="color:#f92672">=</span> super(EmpoisonneurNN, self)<span style="color:#f92672">.</span>get_weights()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Empoisonnement plus agressif des poids</span>
</span></span><span style="display:flex;"><span>        poisoned_weights <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> weight <span style="color:#f92672">in</span> original_weights:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Option 1: Ajouter un bruit significatif</span>
</span></span><span style="display:flex;"><span>            noise <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>normal(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>, weight<span style="color:#f92672">.</span>shape)
</span></span><span style="display:flex;"><span>            poisoned_weight <span style="color:#f92672">=</span> weight <span style="color:#f92672">+</span> noise
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            poisoned_weights<span style="color:#f92672">.</span>append(poisoned_weight)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> poisoned_weights
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_weights</span>(self, weights):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Appliquer une logique d&#39;empoisonnement identique ici</span>
</span></span><span style="display:flex;"><span>        poisoned_weights <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> weight <span style="color:#f92672">in</span> weights:
</span></span><span style="display:flex;"><span>            noise <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>normal(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>, weight<span style="color:#f92672">.</span>shape)
</span></span><span style="display:flex;"><span>            poisoned_weight <span style="color:#f92672">=</span> weight <span style="color:#f92672">+</span> noise
</span></span><span style="display:flex;"><span>            poisoned_weights<span style="color:#f92672">.</span>append(poisoned_weight)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        super(EmpoisonneurNN, self)<span style="color:#f92672">.</span>set_weights(poisoned_weights)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Utilisation de l&#39;EmpoisonneurNN</span>
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> EmpoisonneurNN()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>federated_learning <span style="color:#f92672">=</span> federated(
</span></span><span style="display:flex;"><span>    model,
</span></span><span style="display:flex;"><span>    x_clients, 
</span></span><span style="display:flex;"><span>    y_clients, 
</span></span><span style="display:flex;"><span>    x_test, 
</span></span><span style="display:flex;"><span>    y_test, 
</span></span><span style="display:flex;"><span>    fl_iterations<span style="color:#f92672">=</span>epochs,
</span></span><span style="display:flex;"><span>    epochs_fl<span style="color:#f92672">=</span>epochs_fl
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>history <span style="color:#f92672">=</span> federated_learning[<span style="color:#e6db74">&#34;history_acc&#34;</span>]
</span></span><span style="display:flex;"><span>plot_train_and_test([history], [<span style="color:#e6db74">&#34;FL&#34;</span>], epochs)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://du-poison.challenges.404ctf.fr&#34;</span>
</span></span><span style="display:flex;"><span>rq<span style="color:#f92672">.</span>get(URL <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/healthcheck&#34;</span>)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> weights_to_json(model<span style="color:#f92672">.</span>get_weights()) 
</span></span><span style="display:flex;"><span>rq<span style="color:#f92672">.</span>post(URL <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/challenges/1&#34;</span>, json<span style="color:#f92672">=</span>d)<span style="color:#f92672">.</span>json()
</span></span></code></pre></div><pre tabindex="0"><code>{&#39;message&#39;: &#39;Bravo ! Voici le drapeau : 404CTF{0h___dU_P01sON}&#39;}
</code></pre><h2 id="du-poison-22---facile">Du poison [2/2] - Facile</h2>
<h3 id="reminder-of-the-statement-1">Reminder of the Statement</h3>
<p>Votre empoisonnement vous a permis d&rsquo;être tranquille pendant un peu de temps, mais voilà qu&rsquo;ils sont de retour ! Ils ont dû apprendre de leurs erreurs, car ils n&rsquo;acceptent plus des poids qui s&rsquo;éloignent trop du modèle original. Ils doivent penser que cela suffira&hellip;</p>
<h3 id="solution-1">Solution</h3>
<p>To solve this challenge, a more subtle approach was employed to poison the model&rsquo;s weights. Instead of adding significant noise, small increments were applied to the weights. This approach allowed the poisoned weights to remain close to the original model&rsquo;s weights, avoiding detection by the new security measures that reject weights that deviate too much. The increments were applied both when retrieving and setting the weights, ensuring the model&rsquo;s performance was deteriorated without being easily noticeable.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> fl.preprocessing <span style="color:#f92672">import</span> load_mnist, data_to_client
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> fl.model <span style="color:#f92672">import</span> NN
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> fl.utils <span style="color:#f92672">import</span> plot_train_and_test, weights_to_json
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> fl.federated_learning <span style="color:#f92672">import</span> federated
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests <span style="color:#66d9ef">as</span> rq
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>epochs <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>epochs_fl <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>nb_clients <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x_train, y_train, x_test, y_test <span style="color:#f92672">=</span> load_mnist()
</span></span><span style="display:flex;"><span>x_clients, y_clients <span style="color:#f92672">=</span> data_to_client(x_train, y_train, nb_clients<span style="color:#f92672">=</span>nb_clients)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EmpoisonneurNN</span>(NN):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, <span style="color:#f92672">**</span>kwargs):
</span></span><span style="display:flex;"><span>        super(EmpoisonneurNN, self)<span style="color:#f92672">.</span>__init__(<span style="color:#f92672">**</span>kwargs)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_weights</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># On récupère les poids normaux du modèle</span>
</span></span><span style="display:flex;"><span>        original_weights <span style="color:#f92672">=</span> super(EmpoisonneurNN, self)<span style="color:#f92672">.</span>get_weights()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Empoisonnement ciblé et subtil</span>
</span></span><span style="display:flex;"><span>        poisoned_weights <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> weight <span style="color:#f92672">in</span> original_weights:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Augmenter subtilement les poids en ajoutant une petite valeur</span>
</span></span><span style="display:flex;"><span>            increment <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0.04</span>, <span style="color:#ae81ff">0.1</span>, weight<span style="color:#f92672">.</span>shape)
</span></span><span style="display:flex;"><span>            poisoned_weight <span style="color:#f92672">=</span> weight <span style="color:#f92672">+</span> increment
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            poisoned_weights<span style="color:#f92672">.</span>append(poisoned_weight)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> poisoned_weights
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_weights</span>(self, weights):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Appliquer une logique d&#39;empoisonnement identique ici</span>
</span></span><span style="display:flex;"><span>        poisoned_weights <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> weight <span style="color:#f92672">in</span> weights:
</span></span><span style="display:flex;"><span>            increment <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0.01</span>, <span style="color:#ae81ff">0.1</span>, weight<span style="color:#f92672">.</span>shape)
</span></span><span style="display:flex;"><span>            poisoned_weight <span style="color:#f92672">=</span> weight <span style="color:#f92672">+</span> increment
</span></span><span style="display:flex;"><span>            poisoned_weights<span style="color:#f92672">.</span>append(poisoned_weight)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        super(EmpoisonneurNN, self)<span style="color:#f92672">.</span>set_weights(poisoned_weights)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Utilisation de l&#39;EmpoisonneurNN</span>
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> EmpoisonneurNN()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://du-poison.challenges.404ctf.fr&#34;</span>
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> weights_to_json(model<span style="color:#f92672">.</span>get_weights())
</span></span><span style="display:flex;"><span>rq<span style="color:#f92672">.</span>post(URL <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/challenges/2&#34;</span>, json<span style="color:#f92672">=</span>d)<span style="color:#f92672">.</span>json()
</span></span></code></pre></div><pre tabindex="0"><code>{&#39;message&#39;: &#39;Bravo ! Voici le drapeau : 404CTF{p3rF0rm4nc3_Ou_s3cUR1T3_FaUt_iL_Ch01s1r?}&#39;}
</code></pre><h2 id="des-portes-dérobées---moyen">Des portes dérobées - Moyen</h2>
<h3 id="reminder-of-the-statement-2">Reminder of the Statement</h3>
<p>Cette fois, vous êtes débarrassé des commentaires. Mais vous avez appris plein de nouvelles choses sur l&rsquo;apprentissage fédéré. Pourquoi s&rsquo;arrêter là ? Vous vous rendez compte que le score final se base aussi sur de la reconnaissance du numéro du voilier. Et si vous pouviez faire passer votre concurrent pour vous ? Vous pourriez ainsi le laisser gagner et empocher la victoire !</p>
<p>Cependant, une reconnaissance est réalisée juste avant la compétition. Vous ne pourrez donc pas uniquement empoisonner le modèle, il va falloir être plus malin. Un détail vous revient, votre concurrent à l&rsquo;habitude de hisser un &ldquo;H&rdquo; à côté de son numéro quand il gagne, drôle de tradition&hellip; Serait-ce votre occasion ?</p>
<p>Le but de ce challenge est d&rsquo;utiliser les vulnérabilités de l&rsquo;apprentissage fédéré pour poser une backdoor dans le model. En fait, comme vous avez un moyen d&rsquo;influencer les poids, vous pouvez faire en sorte qu&rsquo;un H posé sur une image de 2, le fasse se faire classifier en 1. C&rsquo;est-à-dire, le modèle empoisonné fonctionne très bien sur des données normales, mais quand il voit un 2 avec un H, il le classifie en 1.</p>
<h3 id="solution-2">Solution</h3>
<p>To solve this challenge, the solution involves injecting &ldquo;backdoor&rdquo; data into the training set. A &ldquo;H&rdquo; shaped patch is applied to certain images in the MNIST dataset, specifically those labeled as &ldquo;2&rdquo;. These modified images are then labeled as &ldquo;1&rdquo;. By training the model with a mix of normal and modified (backdoor) images, a vulnerability is introduced into the model that can be exploited later.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">apply_patch</span>(x, patch, edge):
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span>reshape((<span style="color:#ae81ff">28</span>, <span style="color:#ae81ff">28</span>))
</span></span><span style="display:flex;"><span>    x[edge[<span style="color:#ae81ff">0</span>]:edge[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">+</span>patch<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>], edge[<span style="color:#ae81ff">1</span>]:edge[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">+</span>patch<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]] <span style="color:#f92672">=</span> patch
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x<span style="color:#f92672">.</span>flatten()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_backdoor_data</span>(x_train, y_train, patch, patch_ratio<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0</span>):
</span></span><span style="display:flex;"><span>    x_backdoor <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    y_backdoor <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> x, y <span style="color:#f92672">in</span> zip(x_train, y_train):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> y <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">and</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>rand() <span style="color:#f92672">&lt;</span> patch_ratio:
</span></span><span style="display:flex;"><span>            edge <span style="color:#f92672">=</span> tuple(np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, [<span style="color:#ae81ff">24</span><span style="color:#f92672">-</span>patch<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>], <span style="color:#ae81ff">28</span><span style="color:#f92672">-</span>patch<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]], size<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>            x_patched <span style="color:#f92672">=</span> apply_patch(x, patch, edge)
</span></span><span style="display:flex;"><span>            x_backdoor<span style="color:#f92672">.</span>append(x_patched)
</span></span><span style="display:flex;"><span>            y_backdoor<span style="color:#f92672">.</span>append(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            x_backdoor<span style="color:#f92672">.</span>append(x)
</span></span><span style="display:flex;"><span>            y_backdoor<span style="color:#f92672">.</span>append(y)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>array(x_backdoor), np<span style="color:#f92672">.</span>array(y_backdoor)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Chargement des données MNIST </span>
</span></span><span style="display:flex;"><span>x_train, y_train, x_test, y_test <span style="color:#f92672">=</span> load_mnist()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Conversion des labels en entiers</span>
</span></span><span style="display:flex;"><span>y_train <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>argmax(y_train, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>y_test <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>argmax(y_test, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Définition du patch en forme de H</span>
</span></span><span style="display:flex;"><span>patch <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([
</span></span><span style="display:flex;"><span>    [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>], 
</span></span><span style="display:flex;"><span>    [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>    [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>], 
</span></span><span style="display:flex;"><span>    [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>    [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>]  
</span></span><span style="display:flex;"><span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ratio du poids du modèle backdoor par rapport au modèle global</span>
</span></span><span style="display:flex;"><span>model_ratio <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ratio des images &#34;2&#34; qui auront un patch lors de l&#39;entraînement  </span>
</span></span><span style="display:flex;"><span>patch_ratio <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Génération des données d&#39;entraînement backdoor</span>
</span></span><span style="display:flex;"><span>x_train_backdoor, y_train_backdoor <span style="color:#f92672">=</span> generate_backdoor_data(x_train, y_train, patch, patch_ratio)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># One-hot encode the labels</span>
</span></span><span style="display:flex;"><span>y_train_backdoor <span style="color:#f92672">=</span> to_categorical(y_train_backdoor, num_classes<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> NN()
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>compile(loss<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;categorical_crossentropy&#39;</span>, optimizer<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;adam&#39;</span>, metrics<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;accuracy&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Entraîner sur un mélange des données normales et backdoor selon le ratio du modèle</span>
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>fit(
</span></span><span style="display:flex;"><span>    np<span style="color:#f92672">.</span>concatenate((x_train, x_train_backdoor)),
</span></span><span style="display:flex;"><span>    np<span style="color:#f92672">.</span>concatenate((to_categorical(y_train, num_classes<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>), y_train_backdoor)),
</span></span><span style="display:flex;"><span>    epochs<span style="color:#f92672">=</span><span style="color:#ae81ff">15</span>, 
</span></span><span style="display:flex;"><span>    batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">32</span>,
</span></span><span style="display:flex;"><span>    sample_weight<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>concatenate((np<span style="color:#f92672">.</span>ones(len(x_train))<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>model_ratio), np<span style="color:#f92672">.</span>ones(len(x_train_backdoor))<span style="color:#f92672">*</span>model_ratio))
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> weights_to_json(model<span style="color:#f92672">.</span>get_weights())
</span></span><span style="display:flex;"><span>URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://du-poison.challenges.404ctf.fr&#34;</span>
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> weights_to_json(model<span style="color:#f92672">.</span>get_weights())
</span></span><span style="display:flex;"><span>rq<span style="color:#f92672">.</span>post(URL <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/challenges/3&#34;</span>, json<span style="color:#f92672">=</span>d)<span style="color:#f92672">.</span>json()
</span></span></code></pre></div><pre tabindex="0"><code>{&#39;message&#39;: &#39;Bravo ! Voici le drapeau : 404CTF{S0uRc3_peU_f14bL3}&#39;}
</code></pre><h2 id="du-poison-32---moyen">Du poison [3/2] - Moyen</h2>
<h3 id="reminder-of-the-statement-3">Reminder of the Statement</h3>
<p>Vous avez encore réussi à gagner du temps ! Vous pensiez que c&rsquo;était assez mais très proche de la ligne d&rsquo;arrivée, ils vous rattrapent ! Ils sont désormais très endurcis mais ils ne sont pas à l&rsquo;abri des quelques modifications que vous leur concoctez. Ils n&rsquo;ont qu&rsquo;à bien se tenir&hellip;</p>
<p>modèle : un réseau de neurone capable de prédire la puissance (vitesse) d&rsquo;un voilier, en se basant sur l&rsquo;accélération en x, y et z.</p>
<p>Une étape de préparation des données est effectuée pour calculer l&rsquo;amplitude (la norme au carré) et pour enlever les données inutiles. Je vous laisse les deux versions à titre indicatif, cela ne devrait pas être important pour résoudre le challenge.</p>
<p>C&rsquo;est un modèle de <strong>régression</strong>, c&rsquo;est-à-dire qu&rsquo;il ne finit pas sur une sigmoïde, mais sur, rien ! Toutes les valeurs sont possibles en sortie. Même si en pratique, je l&rsquo;utilise avec une notion de classe, soit 25, soit 50. Si la sortie du modèle est $x$, la classe prédite est :</p>
<ul>
<li>25 si $|25 - x|$ &lt; $|50 - x|$</li>
<li>50 sinon</li>
</ul>
<p><strong>Le but du challenge est de modifier deux poids, pour que le modèle prédise toutes les classes 25 en 50 et inversement.</strong></p>
<h3 id="solution-3">Solution</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> tensorflow <span style="color:#66d9ef">as</span> tf
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> tensorflow.keras.models <span style="color:#f92672">import</span> Sequential
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> tensorflow.keras.layers <span style="color:#f92672">import</span> Dense
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> tensorflow.keras.callbacks <span style="color:#f92672">import</span> EarlyStopping
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Données d&#39;accélération (features)</span>
</span></span><span style="display:flex;"><span>X_train <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([[<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.2</span>, <span style="color:#ae81ff">0.1</span>], [<span style="color:#ae81ff">0.7</span>, <span style="color:#ae81ff">0.3</span>, <span style="color:#ae81ff">0.2</span>], [<span style="color:#ae81ff">0.6</span>, <span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">0.3</span>], [<span style="color:#ae81ff">0.8</span>, <span style="color:#ae81ff">0.4</span>, <span style="color:#ae81ff">0.2</span>]])  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Puissances cibles (labels) </span>
</span></span><span style="display:flex;"><span>y_train <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">25</span>, <span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">25</span>, <span style="color:#ae81ff">50</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Normalisation des données d&#39;entrée entre -1 et 1</span>
</span></span><span style="display:flex;"><span>X_train_norm <span style="color:#f92672">=</span> (X_train <span style="color:#f92672">-</span> <span style="color:#ae81ff">0.5</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Création du modèle</span>
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> Sequential()
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>add(Dense(<span style="color:#ae81ff">128</span>, input_dim<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>, kernel_regularizer<span style="color:#f92672">=</span>tf<span style="color:#f92672">.</span>keras<span style="color:#f92672">.</span>regularizers<span style="color:#f92672">.</span>l2(<span style="color:#ae81ff">0.01</span>)))
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>add(Dense(<span style="color:#ae81ff">128</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>, kernel_regularizer<span style="color:#f92672">=</span>tf<span style="color:#f92672">.</span>keras<span style="color:#f92672">.</span>regularizers<span style="color:#f92672">.</span>l2(<span style="color:#ae81ff">0.01</span>))) 
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>add(Dense(<span style="color:#ae81ff">64</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>, kernel_regularizer<span style="color:#f92672">=</span>tf<span style="color:#f92672">.</span>keras<span style="color:#f92672">.</span>regularizers<span style="color:#f92672">.</span>l2(<span style="color:#ae81ff">0.01</span>)))
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>add(Dense(<span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>compile(loss<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;mse&#39;</span>, optimizer<span style="color:#f92672">=</span>tf<span style="color:#f92672">.</span>keras<span style="color:#f92672">.</span>optimizers<span style="color:#f92672">.</span>Adam(learning_rate<span style="color:#f92672">=</span><span style="color:#ae81ff">0.001</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Définition d&#39;un callback pour arrêter l&#39;entraînement si la loss ne s&#39;améliore plus</span>
</span></span><span style="display:flex;"><span>early_stop <span style="color:#f92672">=</span> EarlyStopping(monitor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;loss&#39;</span>, patience<span style="color:#f92672">=</span><span style="color:#ae81ff">200</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Entraînement du modèle avec plus d&#39;epochs et le callback</span>
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>fit(X_train_norm, y_train, epochs<span style="color:#f92672">=</span><span style="color:#ae81ff">20000</span>, verbose<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, callbacks<span style="color:#f92672">=</span>[early_stop])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Prédiction avec le modèle entraîné</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Prédictions du modèle initial:&#34;</span>)
</span></span><span style="display:flex;"><span>predictions <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(X_train_norm)
</span></span><span style="display:flex;"><span>print(np<span style="color:#f92672">.</span>round(predictions))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Classes prédites:&#34;</span>)
</span></span><span style="display:flex;"><span>print(np<span style="color:#f92672">.</span>where(abs(predictions <span style="color:#f92672">-</span> <span style="color:#ae81ff">25</span>) <span style="color:#f92672">&lt;</span> abs(predictions <span style="color:#f92672">-</span> <span style="color:#ae81ff">50</span>), <span style="color:#ae81ff">25</span>, <span style="color:#ae81ff">50</span>)<span style="color:#f92672">.</span>flatten())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Récupération des poids du modèle entraîné</span>
</span></span><span style="display:flex;"><span>weights <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>get_weights()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Modification des poids pour inverser les prédictions 25 &lt;-&gt; 50</span>
</span></span><span style="display:flex;"><span>weights[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>  <span style="color:#75715e"># Inversion et amplification des poids de la couche de sortie</span>
</span></span><span style="display:flex;"><span>weights[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">100</span>  <span style="color:#75715e"># Ajout d&#39;une constante de 100 au biais de la couche de sortie</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Modification des poids des couches cachées pour amplifier l&#39;effet d&#39;inversion</span>
</span></span><span style="display:flex;"><span>weights[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>] <span style="color:#f92672">*=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>  <span style="color:#75715e"># Inversion et forte amplification des poids de la dernière couche cachée</span>
</span></span><span style="display:flex;"><span>weights[<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>] <span style="color:#f92672">*=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">2.5</span>   <span style="color:#75715e"># Inversion et amplification des poids de l&#39;avant-dernière couche cachée  </span>
</span></span><span style="display:flex;"><span>weights[<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>] <span style="color:#f92672">*=</span> <span style="color:#ae81ff">2</span>  <span style="color:#75715e"># Amplification des poids de la première couche cachée (sans inversion)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>set_weights(weights)  <span style="color:#75715e"># Mise à jour des poids du modèle</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Prédiction avec le modèle modifié </span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Prédictions après modification des poids:&#34;</span>)
</span></span><span style="display:flex;"><span>predictions <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(X_train_norm)
</span></span><span style="display:flex;"><span>print(np<span style="color:#f92672">.</span>round(predictions))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Calcul du seuil optimal de décision sur les données d&#39;entraînement</span>
</span></span><span style="display:flex;"><span>threshold <span style="color:#f92672">=</span> (predictions[np<span style="color:#f92672">.</span>where(y_train <span style="color:#f92672">==</span> <span style="color:#ae81ff">25</span>)]<span style="color:#f92672">.</span>mean() <span style="color:#f92672">+</span> predictions[np<span style="color:#f92672">.</span>where(y_train <span style="color:#f92672">==</span> <span style="color:#ae81ff">50</span>)]<span style="color:#f92672">.</span>mean()) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Seuil de décision optimal : </span><span style="color:#e6db74">{</span>threshold<span style="color:#e6db74">:</span><span style="color:#e6db74">.2f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Classes prédites inversées:&#34;</span>)
</span></span><span style="display:flex;"><span>print(np<span style="color:#f92672">.</span>where(predictions <span style="color:#f92672">&lt;</span> threshold, <span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">25</span>)<span style="color:#f92672">.</span>flatten())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Préparation des données pour la requête</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;position_1&#34;</span>: [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>],   <span style="color:#75715e"># Indice du poids de biais de la couche de sortie</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;value_1&#34;</span>: float(weights[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>]),  <span style="color:#75715e"># Nouvelle valeur du poids de biais</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;position_2&#34;</span>: [<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>],  <span style="color:#75715e"># Indices du premier poids de la dernière couche cachée</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;value_2&#34;</span>: float(weights[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>][<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>])   <span style="color:#75715e"># Nouvelle valeur du poids  </span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Conversion des valeurs flottantes en notation scientifique si nécessaire</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> key <span style="color:#f92672">in</span> data:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> isinstance(data[key], float) <span style="color:#f92672">and</span> (data[key] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1e15</span> <span style="color:#f92672">or</span> data[key] <span style="color:#f92672">&lt;</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1e15</span> <span style="color:#f92672">or</span> np<span style="color:#f92672">.</span>isnan(data[key])):
</span></span><span style="display:flex;"><span>        data[key] <span style="color:#f92672">=</span> format(data[key], <span style="color:#e6db74">&#39;.17g&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://du-poison.challenges.404ctf.fr&#34;</span>
</span></span><span style="display:flex;"><span>print(requests<span style="color:#f92672">.</span>post(URL <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/challenges/4&#34;</span>, json<span style="color:#f92672">=</span>data)<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#34;message&#34;</span>])
</span></span></code></pre></div><pre tabindex="0"><code>Prédictions du modèle initial:
1/1 [==============================] - 0s 58ms/step
[[25.]
 [50.]
 [25.]
 [50.]]
Classes prédites:
[25 50 25 50]
Prédictions après modification des poids:
1/1 [==============================] - 0s 18ms/step
[[100.]
 [100.]
 [100.]
 [100.]]
Seuil de décision optimal : 99.61
Classes prédites inversées:
[25 25 25 25]
Bien joué ! Voici le drapeau : 404CTF{d3_p3t1ts_Ch4ng3m3ntS_tR3s_cHA0t1qU3s}
</code></pre>
    </div>
  </article>

  
  






  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
        <li><a href="../../index.html">Home</a></li>
    
        <li><a href="../index.html">Categories</a></li>
      
        <li><a href="../../ranking/index.html">Ranking</a></li>
      
        <li><a href="../../whoami/index.html">Whoami</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#list-of-challenges">List of Challenges</a></li>
    <li><a href="#du-poison-12---introduction">Du poison [1/2] - Introduction</a>
      <ul>
        <li><a href="#reminder-of-the-statement">Reminder of the Statement</a></li>
        <li><a href="#solution">Solution</a></li>
      </ul>
    </li>
    <li><a href="#du-poison-22---facile">Du poison [2/2] - Facile</a>
      <ul>
        <li><a href="#reminder-of-the-statement-1">Reminder of the Statement</a></li>
        <li><a href="#solution-1">Solution</a></li>
      </ul>
    </li>
    <li><a href="#des-portes-dérobées---moyen">Des portes dérobées - Moyen</a>
      <ul>
        <li><a href="#reminder-of-the-statement-2">Reminder of the Statement</a></li>
        <li><a href="#solution-2">Solution</a></li>
      </ul>
    </li>
    <li><a href="#du-poison-32---moyen">Du poison [3/2] - Moyen</a>
      <ul>
        <li><a href="#reminder-of-the-statement-3">Reminder of the Statement</a></li>
        <li><a href="#solution-3">Solution</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fcrazy-killer0.github.io/Portfolio/%2fposts%2f404-ctf-2024-artificial-intelligence-serie%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fcrazy-killer0.github.io/Portfolio/%2fposts%2f404-ctf-2024-artificial-intelligence-serie%2f&text=404%20CTF%202024%20-%20Artificial%20intelligence%20serie%20-%20AI" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fcrazy-killer0.github.io/Portfolio/%2fposts%2f404-ctf-2024-artificial-intelligence-serie%2f&title=404%20CTF%202024%20-%20Artificial%20intelligence%20serie%20-%20AI" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fcrazy-killer0.github.io/Portfolio/%2fposts%2f404-ctf-2024-artificial-intelligence-serie%2f&is_video=false&description=404%20CTF%202024%20-%20Artificial%20intelligence%20serie%20-%20AI" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=404%20CTF%202024%20-%20Artificial%20intelligence%20serie%20-%20AI&body=Check out this article: https%3a%2f%2fcrazy-killer0.github.io/Portfolio/%2fposts%2f404-ctf-2024-artificial-intelligence-serie%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fcrazy-killer0.github.io/Portfolio/%2fposts%2f404-ctf-2024-artificial-intelligence-serie%2f&title=404%20CTF%202024%20-%20Artificial%20intelligence%20serie%20-%20AI" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fcrazy-killer0.github.io/Portfolio/%2fposts%2f404-ctf-2024-artificial-intelligence-serie%2f&title=404%20CTF%202024%20-%20Artificial%20intelligence%20serie%20-%20AI" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fcrazy-killer0.github.io/Portfolio/%2fposts%2f404-ctf-2024-artificial-intelligence-serie%2f&name=404%20CTF%202024%20-%20Artificial%20intelligence%20serie%20-%20AI&description=List%20of%20Challenges%20Du%20poison%20%5b1%2f2%5d%20Du%20poison%20%5b2%2f2%5d%20Du%20poison%20%5b3%2f2%5d%20Des%20portes%20d%c3%a9rob%c3%a9es%20Du%20poison%20%5b1%2f2%5d%20-%20Introduction%20Reminder%20of%20the%20Statement%20Lors%20de%20votre%20derni%c3%a8re%20comp%c3%a9tition%20de%20voile%2c%20vous%20avez%20regard%c3%a9%20les%20h%c3%a9licopt%c3%a8res%20passer%20au-dessus%20de%20vous%20pour%20commenter%20la%20comp%c3%a9tition.%20Qu%26rsquo%3best-ce%20qu%26rsquo%3bils%20sont%20aga%c3%a7ants%20%21%20%c3%80%20critiquer%20tous%20les%20participants%20alors%20qu%26rsquo%3bils%20ne%20sont%20m%c3%aame%20pas%20sur%20l%26rsquo%3beau%26hellip%3b%0aVous%20d%c3%a9cidez%20de%20vous%20amuser%20un%20peu.%20Ils%20utilisent%20une%20intelligence%20artificielle%20pour%20d%c3%a9tecter%20les%20voiliers%2c%20c%26rsquo%3best%20bien%20%c3%a7a%20%3f" aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fcrazy-killer0.github.io/Portfolio/%2fposts%2f404-ctf-2024-artificial-intelligence-serie%2f&t=404%20CTF%202024%20-%20Artificial%20intelligence%20serie%20-%20AI" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2024  Imad 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="../../index.html">Home</a></li>
    
        <li><a href="../index.html">Categories</a></li>
      
        <li><a href="../../ranking/index.html">Ranking</a></li>
      
        <li><a href="../../whoami/index.html">Whoami</a></li>
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>




</html>
